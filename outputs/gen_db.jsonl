{"scenario": "SurveyMonkey Apply", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT UNIQUE NOT NULL, email TEXT UNIQUE NOT NULL, full_name TEXT, organization_id INTEGER, profile_json TEXT, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE SET NULL);", "indexes": ["CREATE INDEX idx_users_org ON users(organization_id);", "CREATE INDEX idx_users_email ON users(email);"]}, {"name": "organizations", "ddl": "CREATE TABLE organizations (id INTEGER PRIMARY KEY, name TEXT UNIQUE NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": []}, {"name": "programs", "ddl": "CREATE TABLE programs (id INTEGER PRIMARY KEY, owner_user_id INTEGER NOT NULL, name TEXT NOT NULL, description TEXT, default_time_zone TEXT NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(owner_user_id, name));", "indexes": ["CREATE INDEX idx_programs_owner ON programs(owner_user_id);"]}, {"name": "cycles", "ddl": "CREATE TABLE cycles (id INTEGER PRIMARY KEY, program_id INTEGER NOT NULL, name TEXT NOT NULL, open_at TEXT NOT NULL, deadline_at TEXT NOT NULL, late_until_at TEXT, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (program_id) REFERENCES programs(id) ON DELETE CASCADE, UNIQUE(program_id, name), CHECK (late_until_at IS NULL OR late_until_at >= deadline_at));", "indexes": ["CREATE INDEX idx_cycles_program ON cycles(program_id);", "CREATE INDEX idx_cycles_open_deadline ON cycles(open_at, deadline_at);"]}, {"name": "cycle_stages", "ddl": "CREATE TABLE cycle_stages (id INTEGER PRIMARY KEY, cycle_id INTEGER NOT NULL, name TEXT NOT NULL, stage_order INTEGER NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE CASCADE, UNIQUE(cycle_id, name), UNIQUE(cycle_id, stage_order));", "indexes": ["CREATE INDEX idx_cycle_stages_cycle_order ON cycle_stages(cycle_id, stage_order);"]}, {"name": "application_forms", "ddl": "CREATE TABLE application_forms (id INTEGER PRIMARY KEY, cycle_id INTEGER NOT NULL UNIQUE, name TEXT NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE CASCADE);", "indexes": ["CREATE INDEX idx_application_forms_cycle ON application_forms(cycle_id);"]}, {"name": "form_sections", "ddl": "CREATE TABLE form_sections (id INTEGER PRIMARY KEY, form_id INTEGER NOT NULL, title TEXT NOT NULL, section_order INTEGER NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (form_id) REFERENCES application_forms(id) ON DELETE CASCADE, UNIQUE(form_id, section_order), UNIQUE(form_id, title));", "indexes": ["CREATE INDEX idx_form_sections_form_order ON form_sections(form_id, section_order);"]}, {"name": "form_questions", "ddl": "CREATE TABLE form_questions (id INTEGER PRIMARY KEY, section_id INTEGER NOT NULL, question_key TEXT NOT NULL, label TEXT NOT NULL, question_type TEXT NOT NULL CHECK (question_type IN ('text','long_text','number','dropdown')), is_required INTEGER NOT NULL DEFAULT 0 CHECK (is_required IN (0,1)), max_length INTEGER, min_value REAL, max_value REAL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (section_id) REFERENCES form_sections(id) ON DELETE CASCADE, UNIQUE(section_id, question_key), CHECK ((question_type IN ('text','long_text') AND min_value IS NULL AND max_value IS NULL) OR (question_type='number' AND max_length IS NULL) OR (question_type='dropdown' AND max_length IS NULL AND min_value IS NULL AND max_value IS NULL));", "indexes": ["CREATE INDEX idx_form_questions_section ON form_questions(section_id);", "CREATE INDEX idx_form_questions_type ON form_questions(question_type);"]}, {"name": "form_question_options", "ddl": "CREATE TABLE form_question_options (id INTEGER PRIMARY KEY, question_id INTEGER NOT NULL, value TEXT NOT NULL, label TEXT NOT NULL, option_order INTEGER NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (question_id) REFERENCES form_questions(id) ON DELETE CASCADE, UNIQUE(question_id, value), UNIQUE(question_id, option_order));", "indexes": ["CREATE INDEX idx_question_options_question_order ON form_question_options(question_id, option_order);"]}, {"name": "document_requirements", "ddl": "CREATE TABLE document_requirements (id INTEGER PRIMARY KEY, cycle_id INTEGER NOT NULL, name TEXT NOT NULL, is_required INTEGER NOT NULL DEFAULT 1 CHECK (is_required IN (0,1)), allowed_mime_types TEXT NOT NULL, max_bytes INTEGER NOT NULL, submitted_by_role TEXT NOT NULL CHECK (submitted_by_role IN ('applicant','recommender')), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE CASCADE, UNIQUE(cycle_id, name));", "indexes": ["CREATE INDEX idx_docreq_cycle ON document_requirements(cycle_id);"]}, {"name": "eligibility_rules", "ddl": "CREATE TABLE eligibility_rules (id INTEGER PRIMARY KEY, cycle_id INTEGER NOT NULL, name TEXT NOT NULL, field_key TEXT NOT NULL, operator TEXT NOT NULL CHECK (operator IN ('<','<=','>','>=','=','!=','IN','NOT_IN')), value_json TEXT NOT NULL, on_fail_action TEXT NOT NULL DEFAULT 'mark_ineligible' CHECK (on_fail_action IN ('mark_ineligible')), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE CASCADE, UNIQUE(cycle_id, name));", "indexes": ["CREATE INDEX idx_elig_rules_cycle ON eligibility_rules(cycle_id);", "CREATE INDEX idx_elig_rules_field ON eligibility_rules(field_key);"]}, {"name": "submissions", "ddl": "CREATE TABLE submissions (id INTEGER PRIMARY KEY, submission_code TEXT NOT NULL UNIQUE, cycle_id INTEGER NOT NULL, applicant_user_id INTEGER NOT NULL, status TEXT NOT NULL CHECK (status IN ('Draft','Submitted','In Review','Shortlisted','Approved','Rejected','Withdrawn')), ineligible_reason TEXT, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, submitted_at DATETIME, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE CASCADE, FOREIGN KEY (applicant_user_id) REFERENCES users(id) ON DELETE RESTRICT);", "indexes": ["CREATE INDEX idx_submissions_cycle_status_created ON submissions(cycle_id, status, created_at);", "CREATE INDEX idx_submissions_cycle_applicant ON submissions(cycle_id, applicant_user_id);"]}, {"name": "submission_answers", "ddl": "CREATE TABLE submission_answers (id INTEGER PRIMARY KEY, submission_id INTEGER NOT NULL, question_id INTEGER NOT NULL, value_text TEXT, value_number REAL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (submission_id) REFERENCES submissions(id) ON DELETE CASCADE, FOREIGN KEY (question_id) REFERENCES form_questions(id) ON DELETE CASCADE, UNIQUE(submission_id, question_id), CHECK (NOT (value_text IS NULL AND value_number IS NULL)));", "indexes": ["CREATE INDEX idx_answers_submission ON submission_answers(submission_id);", "CREATE INDEX idx_answers_question ON submission_answers(question_id);"]}, {"name": "submission_documents", "ddl": "CREATE TABLE submission_documents (id INTEGER PRIMARY KEY, submission_id INTEGER NOT NULL, requirement_id INTEGER NOT NULL, uploaded_by_user_id INTEGER, uploaded_by_role TEXT NOT NULL CHECK (uploaded_by_role IN ('applicant','recommender')), file_name TEXT NOT NULL, mime_type TEXT NOT NULL, file_size_bytes INTEGER NOT NULL, storage_uri TEXT NOT NULL, uploaded_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (submission_id) REFERENCES submissions(id) ON DELETE CASCADE, FOREIGN KEY (requirement_id) REFERENCES document_requirements(id) ON DELETE CASCADE, FOREIGN KEY (uploaded_by_user_id) REFERENCES users(id) ON DELETE SET NULL, UNIQUE(submission_id, requirement_id));", "indexes": ["CREATE INDEX idx_sub_docs_submission ON submission_documents(submission_id);", "CREATE INDEX idx_sub_docs_requirement ON submission_documents(requirement_id);"]}, {"name": "reviewers", "ddl": "CREATE TABLE reviewers (id INTEGER PRIMARY KEY, user_id INTEGER NOT NULL UNIQUE, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE);", "indexes": ["CREATE INDEX idx_reviewers_user ON reviewers(user_id);"]}, {"name": "review_assignments", "ddl": "CREATE TABLE review_assignments (id INTEGER PRIMARY KEY, cycle_id INTEGER NOT NULL, submission_id INTEGER NOT NULL, reviewer_id INTEGER NOT NULL, assigned_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE CASCADE, FOREIGN KEY (submission_id) REFERENCES submissions(id) ON DELETE CASCADE, FOREIGN KEY (reviewer_id) REFERENCES reviewers(id) ON DELETE CASCADE, UNIQUE(submission_id, reviewer_id));", "indexes": ["CREATE INDEX idx_review_assign_cycle_submission ON review_assignments(cycle_id, submission_id);", "CREATE INDEX idx_review_assign_reviewer ON review_assignments(reviewer_id);"]}, {"name": "rubrics", "ddl": "CREATE TABLE rubrics (id INTEGER PRIMARY KEY, name TEXT NOT NULL UNIQUE, require_overall_comment INTEGER NOT NULL DEFAULT 0 CHECK (require_overall_comment IN (0,1)), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": []}, {"name": "rubric_criteria", "ddl": "CREATE TABLE rubric_criteria (id INTEGER PRIMARY KEY, rubric_id INTEGER NOT NULL, name TEXT NOT NULL, min_score INTEGER NOT NULL, max_score INTEGER NOT NULL, criterion_order INTEGER NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (rubric_id) REFERENCES rubrics(id) ON DELETE CASCADE, UNIQUE(rubric_id, name), UNIQUE(rubric_id, criterion_order), CHECK (min_score <= max_score));", "indexes": ["CREATE INDEX idx_rubric_criteria_rubric_order ON rubric_criteria(rubric_id, criterion_order);"]}, {"name": "stage_rubrics", "ddl": "CREATE TABLE stage_rubrics (id INTEGER PRIMARY KEY, cycle_stage_id INTEGER NOT NULL UNIQUE, rubric_id INTEGER NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_stage_id) REFERENCES cycle_stages(id) ON DELETE CASCADE, FOREIGN KEY (rubric_id) REFERENCES rubrics(id) ON DELETE RESTRICT);", "indexes": ["CREATE INDEX idx_stage_rubrics_rubric ON stage_rubrics(rubric_id);"]}, {"name": "reviews", "ddl": "CREATE TABLE reviews (id INTEGER PRIMARY KEY, submission_id INTEGER NOT NULL, reviewer_id INTEGER NOT NULL, rubric_id INTEGER NOT NULL, conflict_status TEXT NOT NULL CHECK (conflict_status IN ('None','Potential','Confirmed')), overall_comment TEXT, submitted_at DATETIME, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (submission_id) REFERENCES submissions(id) ON DELETE CASCADE, FOREIGN KEY (reviewer_id) REFERENCES reviewers(id) ON DELETE CASCADE, FOREIGN KEY (rubric_id) REFERENCES rubrics(id) ON DELETE RESTRICT, UNIQUE(submission_id, reviewer_id, rubric_id));", "indexes": ["CREATE INDEX idx_reviews_submission ON reviews(submission_id);", "CREATE INDEX idx_reviews_reviewer ON reviews(reviewer_id);"]}, {"name": "review_scores", "ddl": "CREATE TABLE review_scores (id INTEGER PRIMARY KEY, review_id INTEGER NOT NULL, criterion_id INTEGER NOT NULL, score INTEGER NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (review_id) REFERENCES reviews(id) ON DELETE CASCADE, FOREIGN KEY (criterion_id) REFERENCES rubric_criteria(id) ON DELETE CASCADE, UNIQUE(review_id, criterion_id));", "indexes": ["CREATE INDEX idx_review_scores_review ON review_scores(review_id);", "CREATE INDEX idx_review_scores_criterion ON review_scores(criterion_id);"]}, {"name": "interview_campaigns", "ddl": "CREATE TABLE interview_campaigns (id INTEGER PRIMARY KEY, cycle_id INTEGER NOT NULL, name TEXT NOT NULL, time_zone TEXT NOT NULL, slot_minutes INTEGER NOT NULL, start_at TEXT NOT NULL, end_at TEXT NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE CASCADE, UNIQUE(cycle_id, name), CHECK (slot_minutes > 0), CHECK (end_at > start_at));", "indexes": ["CREATE INDEX idx_interview_campaigns_cycle ON interview_campaigns(cycle_id);"]}, {"name": "interview_slots", "ddl": "CREATE TABLE interview_slots (id INTEGER PRIMARY KEY, campaign_id INTEGER NOT NULL, start_at TEXT NOT NULL, end_at TEXT NOT NULL, is_booked INTEGER NOT NULL DEFAULT 0 CHECK (is_booked IN (0,1)), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (campaign_id) REFERENCES interview_campaigns(id) ON DELETE CASCADE, UNIQUE(campaign_id, start_at), CHECK (end_at > start_at));", "indexes": ["CREATE INDEX idx_interview_slots_campaign_time ON interview_slots(campaign_id, start_at);", "CREATE INDEX idx_interview_slots_booked ON interview_slots(campaign_id, is_booked);"]}, {"name": "interview_bookings", "ddl": "CREATE TABLE interview_bookings (id INTEGER PRIMARY KEY, campaign_id INTEGER NOT NULL, slot_id INTEGER NOT NULL UNIQUE, submission_id INTEGER NOT NULL UNIQUE, booked_by_user_id INTEGER NOT NULL, booked_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (campaign_id) REFERENCES interview_campaigns(id) ON DELETE CASCADE, FOREIGN KEY (slot_id) REFERENCES interview_slots(id) ON DELETE CASCADE, FOREIGN KEY (submission_id) REFERENCES submissions(id) ON DELETE CASCADE, FOREIGN KEY (booked_by_user_id) REFERENCES users(id) ON DELETE RESTRICT);", "indexes": ["CREATE INDEX idx_interview_bookings_campaign ON interview_bookings(campaign_id);", "CREATE INDEX idx_interview_bookings_submission ON interview_bookings(submission_id);"]}, {"name": "email_templates", "ddl": "CREATE TABLE email_templates (id INTEGER PRIMARY KEY, owner_user_id INTEGER NOT NULL, name TEXT NOT NULL, subject TEXT NOT NULL, body TEXT NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(owner_user_id, name));", "indexes": ["CREATE INDEX idx_email_templates_owner ON email_templates(owner_user_id);"]}, {"name": "email_outbox", "ddl": "CREATE TABLE email_outbox (id INTEGER PRIMARY KEY, cycle_id INTEGER, submission_id INTEGER, recipient_email TEXT NOT NULL, subject TEXT NOT NULL, body TEXT NOT NULL, status TEXT NOT NULL DEFAULT 'queued' CHECK (status IN ('queued','sent','failed')), queued_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, sent_at DATETIME, error_text TEXT, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (cycle_id) REFERENCES cycles(id) ON DELETE SET NULL, FOREIGN KEY (submission_id) REFERENCES submissions(id) ON DELETE SET NULL);", "indexes": ["CREATE INDEX idx_email_outbox_status_queued ON email_outbox(status, queued_at);", "CREATE INDEX idx_email_outbox_cycle ON email_outbox(cycle_id);", "CREATE INDEX idx_email_outbox_submission ON email_outbox(submission_id);"]}, {"name": "awards", "ddl": "CREATE TABLE awards (id INTEGER PRIMARY KEY, submission_id INTEGER NOT NULL UNIQUE, award_amount REAL NOT NULL CHECK (award_amount >= 0), decision_date TEXT NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (submission_id) REFERENCES submissions(id) ON DELETE CASCADE);", "indexes": ["CREATE INDEX idx_awards_decision_date ON awards(decision_date);"]}]}, "db_path": "./outputs/databases/surveymonkey_apply.db"}
{"scenario": "Etsy Digital Downloads", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (\n  id INTEGER PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  email TEXT UNIQUE NOT NULL,\n  display_name TEXT,\n  verification_status TEXT NOT NULL DEFAULT 'verified' CHECK (verification_status IN ('verified','review_required')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_users_verification_status ON users(verification_status);"]}, {"name": "shops", "ddl": "CREATE TABLE shops (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_shops_owner_user_id ON shops(owner_user_id);"]}, {"name": "categories", "ddl": "CREATE TABLE categories (\n  id INTEGER PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE\n);", "indexes": []}, {"name": "listings", "ddl": "CREATE TABLE listings (\n  id INTEGER PRIMARY KEY,\n  shop_id INTEGER NOT NULL,\n  sku TEXT,\n  title TEXT NOT NULL,\n  category_id INTEGER,\n  base_price_amount REAL NOT NULL CHECK (base_price_amount >= 0),\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  fulfillment_type TEXT NOT NULL DEFAULT 'auto' CHECK (fulfillment_type IN ('auto','manual')),\n  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active','inactive','removed')),\n  removed_reason TEXT,\n  removed_by_user_id INTEGER,\n  removed_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (shop_id) REFERENCES shops(id) ON DELETE CASCADE,\n  FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,\n  FOREIGN KEY (removed_by_user_id) REFERENCES users(id) ON DELETE SET NULL,\n  UNIQUE (shop_id, sku)\n);", "indexes": ["CREATE INDEX idx_listings_shop_id ON listings(shop_id);", "CREATE INDEX idx_listings_category_id ON listings(category_id);", "CREATE INDEX idx_listings_status ON listings(status);", "CREATE INDEX idx_listings_sku ON listings(sku);"]}, {"name": "tags", "ddl": "CREATE TABLE tags (\n  id INTEGER PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE\n);", "indexes": []}, {"name": "listing_tags", "ddl": "CREATE TABLE listing_tags (\n  listing_id INTEGER NOT NULL,\n  tag_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (listing_id, tag_id),\n  FOREIGN KEY (listing_id) REFERENCES listings(id) ON DELETE CASCADE,\n  FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_listing_tags_tag_id ON listing_tags(tag_id);"]}, {"name": "listing_files", "ddl": "CREATE TABLE listing_files (\n  id INTEGER PRIMARY KEY,\n  listing_id INTEGER NOT NULL,\n  filename TEXT NOT NULL,\n  mime_type TEXT NOT NULL,\n  size_bytes INTEGER NOT NULL CHECK (size_bytes >= 0),\n  storage_key TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (listing_id) REFERENCES listings(id) ON DELETE CASCADE,\n  UNIQUE (listing_id, filename)\n);", "indexes": ["CREATE INDEX idx_listing_files_listing_id ON listing_files(listing_id);"]}, {"name": "listing_variations", "ddl": "CREATE TABLE listing_variations (\n  id INTEGER PRIMARY KEY,\n  listing_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  position INTEGER NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (listing_id) REFERENCES listings(id) ON DELETE CASCADE,\n  UNIQUE (listing_id, name)\n);", "indexes": ["CREATE INDEX idx_listing_variations_listing_id ON listing_variations(listing_id);"]}, {"name": "variation_options", "ddl": "CREATE TABLE variation_options (\n  id INTEGER PRIMARY KEY,\n  variation_id INTEGER NOT NULL,\n  value TEXT NOT NULL,\n  price_delta_amount REAL NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (variation_id) REFERENCES listing_variations(id) ON DELETE CASCADE,\n  UNIQUE (variation_id, value)\n);", "indexes": ["CREATE INDEX idx_variation_options_variation_id ON variation_options(variation_id);"]}, {"name": "listing_inventory_rules", "ddl": "CREATE TABLE listing_inventory_rules (\n  id INTEGER PRIMARY KEY,\n  listing_id INTEGER NOT NULL,\n  variation_id INTEGER NOT NULL,\n  option_id INTEGER NOT NULL,\n  max_total_sales INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (listing_id) REFERENCES listings(id) ON DELETE CASCADE,\n  FOREIGN KEY (variation_id) REFERENCES listing_variations(id) ON DELETE CASCADE,\n  FOREIGN KEY (option_id) REFERENCES variation_options(id) ON DELETE CASCADE,\n  UNIQUE (listing_id, variation_id, option_id),\n  CHECK (max_total_sales IS NULL OR max_total_sales >= 0)\n);", "indexes": ["CREATE INDEX idx_listing_inventory_rules_listing_id ON listing_inventory_rules(listing_id);", "CREATE INDEX idx_listing_inventory_rules_option_id ON listing_inventory_rules(option_id);"]}, {"name": "coupons", "ddl": "CREATE TABLE coupons (\n  id INTEGER PRIMARY KEY,\n  shop_id INTEGER NOT NULL,\n  code TEXT NOT NULL,\n  discount_type TEXT NOT NULL CHECK (discount_type IN ('percent')),\n  discount_value REAL NOT NULL CHECK (discount_value > 0),\n  minimum_subtotal_amount REAL NOT NULL DEFAULT 0 CHECK (minimum_subtotal_amount >= 0),\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  starts_at DATETIME NOT NULL,\n  ends_at DATETIME NOT NULL,\n  max_redemptions INTEGER,\n  is_active INTEGER NOT NULL DEFAULT 1 CHECK (is_active IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (shop_id) REFERENCES shops(id) ON DELETE CASCADE,\n  UNIQUE (shop_id, code),\n  CHECK (ends_at > starts_at),\n  CHECK (max_redemptions IS NULL OR max_redemptions >= 0)\n);", "indexes": ["CREATE INDEX idx_coupons_shop_id ON coupons(shop_id);", "CREATE INDEX idx_coupons_code ON coupons(code);", "CREATE INDEX idx_coupons_active_window ON coupons(is_active, starts_at, ends_at);"]}, {"name": "sales", "ddl": "CREATE TABLE sales (\n  id INTEGER PRIMARY KEY,\n  shop_id INTEGER NOT NULL,\n  name TEXT,\n  discount_type TEXT NOT NULL CHECK (discount_type IN ('percent')),\n  discount_value REAL NOT NULL CHECK (discount_value > 0),\n  starts_at DATETIME NOT NULL,\n  ends_at DATETIME NOT NULL,\n  allow_coupon_stacking INTEGER NOT NULL DEFAULT 1 CHECK (allow_coupon_stacking IN (0,1)),\n  is_active INTEGER NOT NULL DEFAULT 1 CHECK (is_active IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (shop_id) REFERENCES shops(id) ON DELETE CASCADE,\n  CHECK (ends_at > starts_at)\n);", "indexes": ["CREATE INDEX idx_sales_shop_id ON sales(shop_id);", "CREATE INDEX idx_sales_active_window ON sales(is_active, starts_at, ends_at);"]}, {"name": "sale_listings", "ddl": "CREATE TABLE sale_listings (\n  sale_id INTEGER NOT NULL,\n  listing_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (sale_id, listing_id),\n  FOREIGN KEY (sale_id) REFERENCES sales(id) ON DELETE CASCADE,\n  FOREIGN KEY (listing_id) REFERENCES listings(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_sale_listings_listing_id ON sale_listings(listing_id);"]}, {"name": "orders", "ddl": "CREATE TABLE orders (\n  id INTEGER PRIMARY KEY,\n  shop_id INTEGER NOT NULL,\n  buyer_user_id INTEGER,\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  status TEXT NOT NULL DEFAULT 'placed' CHECK (status IN ('placed','canceled','refunded','partially_refunded')),\n  fulfillment_status TEXT NOT NULL DEFAULT 'manual' CHECK (fulfillment_status IN ('manual','fulfilled')),\n  private_note TEXT,\n  placed_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  fulfilled_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (shop_id) REFERENCES shops(id) ON DELETE CASCADE,\n  FOREIGN KEY (buyer_user_id) REFERENCES users(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_orders_shop_id ON orders(shop_id);", "CREATE INDEX idx_orders_placed_at ON orders(placed_at);", "CREATE INDEX idx_orders_fulfillment_status ON orders(fulfillment_status);"]}, {"name": "order_items", "ddl": "CREATE TABLE order_items (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  listing_id INTEGER NOT NULL,\n  quantity INTEGER NOT NULL DEFAULT 1 CHECK (quantity > 0),\n  unit_price_amount REAL NOT NULL CHECK (unit_price_amount >= 0),\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,\n  FOREIGN KEY (listing_id) REFERENCES listings(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_order_items_order_id ON order_items(order_id);", "CREATE INDEX idx_order_items_listing_id ON order_items(listing_id);"]}, {"name": "order_item_variation_selections", "ddl": "CREATE TABLE order_item_variation_selections (\n  order_item_id INTEGER NOT NULL,\n  variation_id INTEGER NOT NULL,\n  option_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (order_item_id, variation_id),\n  FOREIGN KEY (order_item_id) REFERENCES order_items(id) ON DELETE CASCADE,\n  FOREIGN KEY (variation_id) REFERENCES listing_variations(id) ON DELETE RESTRICT,\n  FOREIGN KEY (option_id) REFERENCES variation_options(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_oiv_option_id ON order_item_variation_selections(option_id);"]}, {"name": "order_applied_discounts", "ddl": "CREATE TABLE order_applied_discounts (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  source_type TEXT NOT NULL CHECK (source_type IN ('coupon','sale')),\n  source_id INTEGER NOT NULL,\n  code TEXT,\n  discount_amount REAL NOT NULL CHECK (discount_amount >= 0),\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_order_applied_discounts_order_id ON order_applied_discounts(order_id);", "CREATE INDEX idx_order_applied_discounts_source ON order_applied_discounts(source_type, source_id);"]}, {"name": "order_fee_lines", "ddl": "CREATE TABLE order_fee_lines (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  fee_type TEXT NOT NULL CHECK (fee_type IN ('platform_fee','processing_fee','tax','other','fee_adjustment')),\n  amount REAL NOT NULL,\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_order_fee_lines_order_id ON order_fee_lines(order_id);", "CREATE INDEX idx_order_fee_lines_fee_type ON order_fee_lines(fee_type);"]}, {"name": "refunds", "ddl": "CREATE TABLE refunds (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  amount REAL NOT NULL CHECK (amount > 0),\n  currency_code TEXT NOT NULL DEFAULT 'USD',\n  reason TEXT NOT NULL,\n  platform_fee_adjustment_amount REAL NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_refunds_order_id ON refunds(order_id);", "CREATE INDEX idx_refunds_created_at ON refunds(created_at);"]}, {"name": "messages", "ddl": "CREATE TABLE messages (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER,\n  shop_id INTEGER NOT NULL,\n  sender_user_id INTEGER,\n  recipient_user_id INTEGER,\n  body TEXT NOT NULL,\n  is_private INTEGER NOT NULL DEFAULT 0 CHECK (is_private IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE SET NULL,\n  FOREIGN KEY (shop_id) REFERENCES shops(id) ON DELETE CASCADE,\n  FOREIGN KEY (sender_user_id) REFERENCES users(id) ON DELETE SET NULL,\n  FOREIGN KEY (recipient_user_id) REFERENCES users(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_messages_order_id ON messages(order_id);", "CREATE INDEX idx_messages_shop_id_created_at ON messages(shop_id, created_at);", "CREATE INDEX idx_messages_recipient_created_at ON messages(recipient_user_id, created_at);"]}, {"name": "admin_actions", "ddl": "CREATE TABLE admin_actions (\n  id INTEGER PRIMARY KEY,\n  actor_user_id INTEGER NOT NULL,\n  action_type TEXT NOT NULL CHECK (action_type IN ('takedown_listing','set_seller_verification_status')),\n  target_type TEXT NOT NULL CHECK (target_type IN ('listing','user')),\n  target_id INTEGER NOT NULL,\n  reason TEXT,\n  message_to_seller TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (actor_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_admin_actions_actor_user_id ON admin_actions(actor_user_id);", "CREATE INDEX idx_admin_actions_target ON admin_actions(target_type, target_id);", "CREATE INDEX idx_admin_actions_created_at ON admin_actions(created_at);"]}]}, "db_path": "./outputs/databases/etsy_digital_downloads.db"}
{"scenario": "Rover", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (\n  id INTEGER PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  email TEXT UNIQUE NOT NULL,\n  full_name TEXT,\n  phone TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_users_email ON users(email);"]}, {"name": "pets", "ddl": "CREATE TABLE pets (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  species TEXT NOT NULL CHECK (species IN ('dog')),\n  breed TEXT,\n  sex TEXT CHECK (sex IN ('male','female','unknown')),\n  birth_date DATE,\n  age_years INTEGER CHECK (age_years IS NULL OR age_years >= 0),\n  behavior_notes TEXT,\n  emergency_contact_name TEXT,\n  emergency_contact_phone TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_pets_owner ON pets(owner_user_id);", "CREATE UNIQUE INDEX uq_pets_owner_name ON pets(owner_user_id, name);"]}, {"name": "pet_vaccinations", "ddl": "CREATE TABLE pet_vaccinations (\n  id INTEGER PRIMARY KEY,\n  pet_id INTEGER NOT NULL,\n  vaccine_type TEXT NOT NULL CHECK (vaccine_type IN ('rabies','dhpp')),\n  administered_on DATE NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (pet_id) REFERENCES pets(id) ON DELETE CASCADE,\n  UNIQUE (pet_id, vaccine_type)\n);", "indexes": ["CREATE INDEX idx_pet_vaccinations_pet ON pet_vaccinations(pet_id);"]}, {"name": "service_listings", "ddl": "CREATE TABLE service_listings (\n  id INTEGER PRIMARY KEY,\n  sitter_user_id INTEGER NOT NULL,\n  service_type TEXT NOT NULL CHECK (service_type IN ('walk','drop_in','boarding','daycare')),\n  title TEXT,\n  description TEXT,\n  house_rules TEXT,\n  price_amount REAL NOT NULL CHECK (price_amount >= 0),\n  price_unit TEXT NOT NULL CHECK (price_unit IN ('per_walk','per_visit','per_night','per_day')),\n  currency TEXT NOT NULL DEFAULT 'USD',\n  base_postal_code TEXT NOT NULL,\n  service_radius_miles REAL NOT NULL CHECK (service_radius_miles > 0),\n  city TEXT,\n  state TEXT,\n  active INTEGER NOT NULL DEFAULT 1 CHECK (active IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (sitter_user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_service_listings_search ON service_listings(service_type, base_postal_code, active);", "CREATE INDEX idx_service_listings_sitter ON service_listings(sitter_user_id);"]}, {"name": "service_availability_rules", "ddl": "CREATE TABLE service_availability_rules (\n  id INTEGER PRIMARY KEY,\n  service_listing_id INTEGER NOT NULL,\n  start_date DATE NOT NULL,\n  day_of_week INTEGER NOT NULL CHECK (day_of_week BETWEEN 0 AND 6),\n  start_time TEXT NOT NULL,\n  end_time TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (service_listing_id) REFERENCES service_listings(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_availability_rules_listing_dow ON service_availability_rules(service_listing_id, day_of_week);"]}, {"name": "service_blackouts", "ddl": "CREATE TABLE service_blackouts (\n  id INTEGER PRIMARY KEY,\n  service_listing_id INTEGER NOT NULL,\n  start_datetime DATETIME NOT NULL,\n  end_datetime DATETIME NOT NULL,\n  reason TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (service_listing_id) REFERENCES service_listings(id) ON DELETE CASCADE,\n  CHECK (end_datetime > start_datetime)\n);", "indexes": ["CREATE INDEX idx_service_blackouts_listing_start_end ON service_blackouts(service_listing_id, start_datetime, end_datetime);"]}, {"name": "service_capacity", "ddl": "CREATE TABLE service_capacity (\n  id INTEGER PRIMARY KEY,\n  service_listing_id INTEGER NOT NULL,\n  max_dogs_per_night INTEGER NOT NULL CHECK (max_dogs_per_night >= 0),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (service_listing_id) REFERENCES service_listings(id) ON DELETE CASCADE,\n  UNIQUE (service_listing_id)\n);", "indexes": ["CREATE INDEX idx_service_capacity_listing ON service_capacity(service_listing_id);"]}, {"name": "sitter_daily_metrics", "ddl": "CREATE TABLE sitter_daily_metrics (\n  id INTEGER PRIMARY KEY,\n  sitter_user_id INTEGER NOT NULL,\n  metric_date DATE NOT NULL,\n  avg_rating REAL CHECK (avg_rating IS NULL OR (avg_rating >= 0 AND avg_rating <= 5)),\n  rating_count INTEGER NOT NULL DEFAULT 0 CHECK (rating_count >= 0),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (sitter_user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE (sitter_user_id, metric_date)\n);", "indexes": ["CREATE INDEX idx_sitter_daily_metrics_sitter_date ON sitter_daily_metrics(sitter_user_id, metric_date);"]}, {"name": "bookings", "ddl": "CREATE TABLE bookings (\n  id INTEGER PRIMARY KEY,\n  booking_code TEXT NOT NULL UNIQUE,\n  service_listing_id INTEGER NOT NULL,\n  owner_user_id INTEGER NOT NULL,\n  sitter_user_id INTEGER NOT NULL,\n  pet_id INTEGER NOT NULL,\n  status TEXT NOT NULL CHECK (status IN ('pending','accepted','declined','canceled','in_progress','completed')),\n  start_datetime DATETIME NOT NULL,\n  end_datetime DATETIME NOT NULL,\n  duration_minutes INTEGER CHECK (duration_minutes IS NULL OR duration_minutes > 0),\n  owner_message TEXT,\n  cancellation_reason_code TEXT CHECK (cancellation_reason_code IN ('pet_illness','schedule_change','found_alternative','weather','other')),\n  canceled_by_user_id INTEGER,\n  canceled_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (service_listing_id) REFERENCES service_listings(id) ON DELETE RESTRICT,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE RESTRICT,\n  FOREIGN KEY (sitter_user_id) REFERENCES users(id) ON DELETE RESTRICT,\n  FOREIGN KEY (pet_id) REFERENCES pets(id) ON DELETE RESTRICT,\n  FOREIGN KEY (canceled_by_user_id) REFERENCES users(id) ON DELETE SET NULL,\n  CHECK (end_datetime > start_datetime)\n);", "indexes": ["CREATE INDEX idx_bookings_owner_start ON bookings(owner_user_id, start_datetime);", "CREATE INDEX idx_bookings_sitter_start ON bookings(sitter_user_id, start_datetime);", "CREATE INDEX idx_bookings_listing_start_end ON bookings(service_listing_id, start_datetime, end_datetime);", "CREATE INDEX idx_bookings_status ON bookings(status);"]}, {"name": "promo_codes", "ddl": "CREATE TABLE promo_codes (\n  id INTEGER PRIMARY KEY,\n  code TEXT NOT NULL UNIQUE,\n  discount_type TEXT NOT NULL CHECK (discount_type IN ('fixed_amount')),\n  discount_value REAL NOT NULL CHECK (discount_value >= 0),\n  currency TEXT NOT NULL DEFAULT 'USD',\n  active INTEGER NOT NULL DEFAULT 1 CHECK (active IN (0,1)),\n  starts_at DATETIME,\n  ends_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_promo_codes_active ON promo_codes(active);"]}, {"name": "booking_pricing", "ddl": "CREATE TABLE booking_pricing (\n  id INTEGER PRIMARY KEY,\n  booking_id INTEGER NOT NULL UNIQUE,\n  currency TEXT NOT NULL DEFAULT 'USD',\n  base_amount REAL NOT NULL CHECK (base_amount >= 0),\n  promo_code_id INTEGER,\n  promo_discount_amount REAL NOT NULL DEFAULT 0 CHECK (promo_discount_amount >= 0),\n  platform_fee_amount REAL NOT NULL DEFAULT 0 CHECK (platform_fee_amount >= 0),\n  total_amount REAL NOT NULL CHECK (total_amount >= 0),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE CASCADE,\n  FOREIGN KEY (promo_code_id) REFERENCES promo_codes(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_booking_pricing_booking ON booking_pricing(booking_id);"]}, {"name": "payments", "ddl": "CREATE TABLE payments (\n  id INTEGER PRIMARY KEY,\n  booking_id INTEGER NOT NULL,\n  payer_user_id INTEGER NOT NULL,\n  amount REAL NOT NULL CHECK (amount >= 0),\n  currency TEXT NOT NULL DEFAULT 'USD',\n  status TEXT NOT NULL CHECK (status IN ('authorized','captured','refunded','voided','failed')),\n  method_type TEXT NOT NULL CHECK (method_type IN ('card','ach','wallet','other')),\n  external_reference TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE CASCADE,\n  FOREIGN KEY (payer_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_payments_booking ON payments(booking_id);", "CREATE INDEX idx_payments_payer ON payments(payer_user_id);"]}, {"name": "refund_requests", "ddl": "CREATE TABLE refund_requests (\n  id INTEGER PRIMARY KEY,\n  booking_id INTEGER NOT NULL,\n  payment_id INTEGER,\n  requested_by_user_id INTEGER NOT NULL,\n  requested_amount REAL CHECK (requested_amount IS NULL OR requested_amount >= 0),\n  refund_to_original_method INTEGER NOT NULL DEFAULT 1 CHECK (refund_to_original_method IN (0,1)),\n  eligibility_status TEXT NOT NULL DEFAULT 'unknown' CHECK (eligibility_status IN ('unknown','eligible','ineligible')),\n  status TEXT NOT NULL DEFAULT 'requested' CHECK (status IN ('requested','approved','rejected','processed')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE CASCADE,\n  FOREIGN KEY (payment_id) REFERENCES payments(id) ON DELETE SET NULL,\n  FOREIGN KEY (requested_by_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_refund_requests_booking ON refund_requests(booking_id);", "CREATE INDEX idx_refund_requests_status ON refund_requests(status);"]}, {"name": "message_threads", "ddl": "CREATE TABLE message_threads (\n  id INTEGER PRIMARY KEY,\n  thread_code TEXT NOT NULL UNIQUE,\n  booking_id INTEGER,\n  owner_user_id INTEGER NOT NULL,\n  sitter_user_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE SET NULL,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE RESTRICT,\n  FOREIGN KEY (sitter_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_message_threads_booking ON message_threads(booking_id);", "CREATE INDEX idx_message_threads_owner_sitter ON message_threads(owner_user_id, sitter_user_id);"]}, {"name": "messages", "ddl": "CREATE TABLE messages (\n  id INTEGER PRIMARY KEY,\n  message_code TEXT NOT NULL UNIQUE,\n  thread_id INTEGER NOT NULL,\n  sender_user_id INTEGER NOT NULL,\n  body TEXT NOT NULL,\n  sent_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (thread_id) REFERENCES message_threads(id) ON DELETE CASCADE,\n  FOREIGN KEY (sender_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_messages_thread_sent ON messages(thread_id, sent_at);", "CREATE INDEX idx_messages_sender ON messages(sender_user_id);"]}, {"name": "visit_reports", "ddl": "CREATE TABLE visit_reports (\n  id INTEGER PRIMARY KEY,\n  booking_id INTEGER NOT NULL,\n  report_datetime DATETIME NOT NULL,\n  potty_notes TEXT,\n  meal_notes TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_visit_reports_booking_datetime ON visit_reports(booking_id, report_datetime);"]}, {"name": "visit_report_photos", "ddl": "CREATE TABLE visit_report_photos (\n  id INTEGER PRIMARY KEY,\n  visit_report_id INTEGER NOT NULL,\n  taken_at TEXT NOT NULL,\n  caption TEXT,\n  storage_key TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (visit_report_id) REFERENCES visit_reports(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_visit_report_photos_report ON visit_report_photos(visit_report_id);"]}, {"name": "fees", "ddl": "CREATE TABLE fees (\n  id INTEGER PRIMARY KEY,\n  booking_id INTEGER NOT NULL,\n  fee_type TEXT NOT NULL CHECK (fee_type IN ('platform_fee','late_cancellation_fee')),\n  amount REAL NOT NULL CHECK (amount >= 0),\n  currency TEXT NOT NULL DEFAULT 'USD',\n  charged INTEGER NOT NULL DEFAULT 0 CHECK (charged IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_fees_booking_type ON fees(booking_id, fee_type);"]}, {"name": "support_tickets", "ddl": "CREATE TABLE support_tickets (\n  id INTEGER PRIMARY KEY,\n  ticket_code TEXT NOT NULL UNIQUE,\n  created_by_user_id INTEGER NOT NULL,\n  booking_id INTEGER,\n  related_thread_id INTEGER,\n  category TEXT NOT NULL CHECK (category IN ('fee_dispute','payment','booking','other')),\n  subject TEXT,\n  description TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'open' CHECK (status IN ('open','in_review','resolved','closed')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (created_by_user_id) REFERENCES users(id) ON DELETE RESTRICT,\n  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE SET NULL,\n  FOREIGN KEY (related_thread_id) REFERENCES message_threads(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_support_tickets_creator ON support_tickets(created_by_user_id);", "CREATE INDEX idx_support_tickets_booking ON support_tickets(booking_id);", "CREATE INDEX idx_support_tickets_status ON support_tickets(status);"]}]}, "db_path": "./outputs/databases/rover.db"}
{"scenario": "GoFundMe", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT NOT NULL UNIQUE, email TEXT NOT NULL UNIQUE, full_name TEXT, profile_json TEXT, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE INDEX idx_users_email ON users(email);"]}, {"name": "categories", "ddl": "CREATE TABLE categories (id INTEGER PRIMARY KEY, name TEXT NOT NULL UNIQUE, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE UNIQUE INDEX idx_categories_name ON categories(name);"]}, {"name": "campaigns", "ddl": "CREATE TABLE campaigns (id INTEGER PRIMARY KEY, owner_user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE, category_id INTEGER NOT NULL REFERENCES categories(id), title TEXT NOT NULL, beneficiary_name TEXT NOT NULL, location_city TEXT NOT NULL, location_region TEXT NOT NULL, location_country TEXT NOT NULL DEFAULT 'US', goal_amount_cents INTEGER NOT NULL CHECK (goal_amount_cents > 0), currency_code TEXT NOT NULL DEFAULT 'USD', status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('draft','active','paused','closed')), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, UNIQUE(owner_user_id, title));", "indexes": ["CREATE INDEX idx_campaigns_owner ON campaigns(owner_user_id);", "CREATE INDEX idx_campaigns_category_location ON campaigns(category_id, location_city, location_region, status);", "CREATE INDEX idx_campaigns_status ON campaigns(status);", "CREATE UNIQUE INDEX idx_campaigns_owner_title ON campaigns(owner_user_id, title);"]}, {"name": "campaign_media", "ddl": "CREATE TABLE campaign_media (id INTEGER PRIMARY KEY, campaign_id INTEGER NOT NULL REFERENCES campaigns(id) ON DELETE CASCADE, filename TEXT NOT NULL, alt_text TEXT, sort_order INTEGER NOT NULL DEFAULT 0, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, UNIQUE(campaign_id, filename));", "indexes": ["CREATE INDEX idx_campaign_media_campaign_sort ON campaign_media(campaign_id, sort_order, id);"]}, {"name": "campaign_updates", "ddl": "CREATE TABLE campaign_updates (id INTEGER PRIMARY KEY, campaign_id INTEGER NOT NULL REFERENCES campaigns(id) ON DELETE CASCADE, author_user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE, title TEXT NOT NULL, body TEXT NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE INDEX idx_campaign_updates_campaign_created ON campaign_updates(campaign_id, created_at DESC);"]}, {"name": "donation_intents", "ddl": "CREATE TABLE donation_intents (id INTEGER PRIMARY KEY, campaign_id INTEGER NOT NULL REFERENCES campaigns(id) ON DELETE CASCADE, donor_user_id INTEGER REFERENCES users(id) ON DELETE SET NULL, donor_name TEXT NOT NULL, message TEXT, is_anonymous INTEGER NOT NULL DEFAULT 0 CHECK (is_anonymous IN (0,1)), kind TEXT NOT NULL CHECK (kind IN ('one_time','recurring')), currency_code TEXT NOT NULL DEFAULT 'USD', amount_cents INTEGER NOT NULL CHECK (amount_cents > 0), start_date DATE, interval_unit TEXT CHECK (interval_unit IN ('month')), interval_count INTEGER CHECK (interval_count >= 1), status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active','canceled','completed')), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, CHECK ((kind = 'one_time' AND start_date IS NULL AND interval_unit IS NULL AND interval_count IS NULL) OR (kind = 'recurring' AND start_date IS NOT NULL AND interval_unit IS NOT NULL AND interval_count IS NOT NULL)));", "indexes": ["CREATE INDEX idx_donation_intents_campaign ON donation_intents(campaign_id);", "CREATE INDEX idx_donation_intents_donor_created ON donation_intents(donor_user_id, created_at DESC);", "CREATE INDEX idx_donation_intents_kind_status ON donation_intents(kind, status);"]}, {"name": "donations", "ddl": "CREATE TABLE donations (id INTEGER PRIMARY KEY, donation_intent_id INTEGER REFERENCES donation_intents(id) ON DELETE SET NULL, campaign_id INTEGER NOT NULL REFERENCES campaigns(id) ON DELETE CASCADE, donor_user_id INTEGER REFERENCES users(id) ON DELETE SET NULL, donor_name TEXT NOT NULL, message TEXT, is_anonymous INTEGER NOT NULL DEFAULT 0 CHECK (is_anonymous IN (0,1)), currency_code TEXT NOT NULL DEFAULT 'USD', amount_cents INTEGER NOT NULL CHECK (amount_cents > 0), donated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE INDEX idx_donations_campaign_donated ON donations(campaign_id, donated_at DESC);", "CREATE INDEX idx_donations_donor_donated ON donations(donor_user_id, donated_at DESC);", "CREATE INDEX idx_donations_intent ON donations(donation_intent_id);"]}, {"name": "receipts", "ddl": "CREATE TABLE receipts (id INTEGER PRIMARY KEY, donation_id INTEGER NOT NULL UNIQUE REFERENCES donations(id) ON DELETE CASCADE, receipt_number TEXT NOT NULL UNIQUE, issued_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, total_amount_cents INTEGER NOT NULL CHECK (total_amount_cents > 0), currency_code TEXT NOT NULL DEFAULT 'USD');", "indexes": ["CREATE UNIQUE INDEX idx_receipts_receipt_number ON receipts(receipt_number);", "CREATE INDEX idx_receipts_issued_at ON receipts(issued_at DESC);"]}, {"name": "payout_methods", "ddl": "CREATE TABLE payout_methods (id INTEGER PRIMARY KEY, owner_user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE, type TEXT NOT NULL CHECK (type IN ('bank_account')), bank_name TEXT NOT NULL, account_last4 TEXT NOT NULL CHECK (length(account_last4) = 4), account_type TEXT NOT NULL CHECK (account_type IN ('checking','savings')), is_default INTEGER NOT NULL DEFAULT 0 CHECK (is_default IN (0,1)), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE INDEX idx_payout_methods_owner ON payout_methods(owner_user_id);", "CREATE INDEX idx_payout_methods_owner_default ON payout_methods(owner_user_id, is_default);"]}, {"name": "campaign_payout_settings", "ddl": "CREATE TABLE campaign_payout_settings (campaign_id INTEGER PRIMARY KEY REFERENCES campaigns(id) ON DELETE CASCADE, default_payout_method_id INTEGER REFERENCES payout_methods(id) ON DELETE SET NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE INDEX idx_campaign_payout_settings_default_method ON campaign_payout_settings(default_payout_method_id);"]}, {"name": "payouts", "ddl": "CREATE TABLE payouts (id INTEGER PRIMARY KEY, campaign_id INTEGER NOT NULL REFERENCES campaigns(id) ON DELETE CASCADE, payout_method_id INTEGER NOT NULL REFERENCES payout_methods(id), amount_cents INTEGER NOT NULL CHECK (amount_cents > 0), currency_code TEXT NOT NULL DEFAULT 'USD', status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending','on_hold','approved','rejected','processing','paid','canceled','failed')), risk_level TEXT NOT NULL DEFAULT 'none' CHECK (risk_level IN ('none','low','medium','high')), risk_flags_json TEXT, verification_required INTEGER NOT NULL DEFAULT 0 CHECK (verification_required IN (0,1)), created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE INDEX idx_payouts_campaign_created ON payouts(campaign_id, created_at DESC);", "CREATE INDEX idx_payouts_status ON payouts(status);", "CREATE INDEX idx_payouts_method ON payouts(payout_method_id);"]}, {"name": "payout_verification_requirements", "ddl": "CREATE TABLE payout_verification_requirements (id INTEGER PRIMARY KEY, payout_id INTEGER NOT NULL REFERENCES payouts(id) ON DELETE CASCADE, requirement_type TEXT NOT NULL CHECK (requirement_type IN ('identity_document','bank_account_ownership','address_proof','tax_form','other')), status TEXT NOT NULL DEFAULT 'required' CHECK (status IN ('required','submitted','approved','rejected','waived')), notes TEXT, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP);", "indexes": ["CREATE INDEX idx_payout_verification_payout ON payout_verification_requirements(payout_id);", "CREATE INDEX idx_payout_verification_status ON payout_verification_requirements(status);"]}]}, "db_path": "./outputs/databases/gofundme.db"}
{"scenario": "DoorDash Drive (Delivery Tracking)", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (\n  id INTEGER PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  email TEXT UNIQUE NOT NULL,\n  full_name TEXT,\n  profile_json TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_users_email ON users(email);"]}, {"name": "merchants", "ddl": "CREATE TABLE merchants (\n  id INTEGER PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_merchants_name ON merchants(name);"]}, {"name": "merchant_locations", "ddl": "CREATE TABLE merchant_locations (\n  id INTEGER PRIMARY KEY,\n  merchant_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  pickup_address_id INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(merchant_id, name),\n  FOREIGN KEY (merchant_id) REFERENCES merchants(id) ON DELETE CASCADE,\n  FOREIGN KEY (pickup_address_id) REFERENCES addresses(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_locations_merchant_id ON merchant_locations(merchant_id);", "CREATE INDEX idx_locations_name ON merchant_locations(name);"]}, {"name": "addresses", "ddl": "CREATE TABLE addresses (\n  id INTEGER PRIMARY KEY,\n  line1 TEXT NOT NULL,\n  line2 TEXT,\n  city TEXT NOT NULL,\n  state TEXT NOT NULL,\n  postal_code TEXT NOT NULL,\n  country TEXT NOT NULL DEFAULT 'US',\n  formatted TEXT,\n  lat REAL,\n  lng REAL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_addresses_city_state ON addresses(city, state);", "CREATE INDEX idx_addresses_lat_lng ON addresses(lat, lng);"]}, {"name": "customers", "ddl": "CREATE TABLE customers (\n  id INTEGER PRIMARY KEY,\n  full_name TEXT NOT NULL,\n  phone TEXT,\n  email TEXT,\n  default_address_id INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (default_address_id) REFERENCES addresses(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_customers_full_name ON customers(full_name);", "CREATE INDEX idx_customers_email ON customers(email);"]}, {"name": "delivery_orders", "ddl": "CREATE TABLE delivery_orders (\n  id INTEGER PRIMARY KEY,\n  external_order_ref TEXT UNIQUE,\n  merchant_id INTEGER NOT NULL,\n  merchant_location_id INTEGER,\n  created_by_user_id INTEGER NOT NULL,\n  customer_id INTEGER,\n  pickup_address_id INTEGER NOT NULL,\n  dropoff_address_id INTEGER NOT NULL,\n  pickup_window_start DATETIME,\n  pickup_window_end DATETIME,\n  dropoff_window_start DATETIME,\n  dropoff_window_end DATETIME,\n  special_instructions TEXT,\n  current_status TEXT NOT NULL DEFAULT 'created' CHECK (current_status IN (\n    'created','scheduled','dispatched','assigned','confirmed','picked_up','en_route','delivered','canceled','failed'\n  )),\n  latest_eta DATETIME,\n  canceled_at DATETIME,\n  cancel_reason TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (merchant_id) REFERENCES merchants(id) ON DELETE RESTRICT,\n  FOREIGN KEY (merchant_location_id) REFERENCES merchant_locations(id) ON DELETE SET NULL,\n  FOREIGN KEY (created_by_user_id) REFERENCES users(id) ON DELETE RESTRICT,\n  FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE SET NULL,\n  FOREIGN KEY (pickup_address_id) REFERENCES addresses(id) ON DELETE RESTRICT,\n  FOREIGN KEY (dropoff_address_id) REFERENCES addresses(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_orders_merchant_created_at ON delivery_orders(merchant_id, created_at);", "CREATE INDEX idx_orders_location_pickup_window ON delivery_orders(merchant_location_id, pickup_window_start, pickup_window_end);", "CREATE INDEX idx_orders_status ON delivery_orders(current_status);", "CREATE INDEX idx_orders_external_ref ON delivery_orders(external_order_ref);"]}, {"name": "delivery_order_items", "ddl": "CREATE TABLE delivery_order_items (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  quantity INTEGER NOT NULL CHECK (quantity > 0),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_order_items_order_id ON delivery_order_items(order_id);"]}, {"name": "drivers", "ddl": "CREATE TABLE drivers (\n  id INTEGER PRIMARY KEY,\n  display_name TEXT NOT NULL,\n  phone TEXT,\n  is_active INTEGER NOT NULL DEFAULT 1 CHECK (is_active IN (0,1)),\n  availability_status TEXT NOT NULL DEFAULT 'available' CHECK (availability_status IN ('available','unavailable','on_delivery')),\n  last_known_lat REAL,\n  last_known_lng REAL,\n  last_known_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_drivers_active_availability ON drivers(is_active, availability_status);", "CREATE INDEX idx_drivers_last_known_at ON drivers(last_known_at);"]}, {"name": "dispatch_batches", "ddl": "CREATE TABLE dispatch_batches (\n  id INTEGER PRIMARY KEY,\n  merchant_location_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  pickup_window_start DATETIME,\n  pickup_window_end DATETIME,\n  created_by_user_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (merchant_location_id) REFERENCES merchant_locations(id) ON DELETE CASCADE,\n  FOREIGN KEY (created_by_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_batches_location_window ON dispatch_batches(merchant_location_id, pickup_window_start, pickup_window_end);"]}, {"name": "dispatch_batch_orders", "ddl": "CREATE TABLE dispatch_batch_orders (\n  batch_id INTEGER NOT NULL,\n  order_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (batch_id, order_id),\n  FOREIGN KEY (batch_id) REFERENCES dispatch_batches(id) ON DELETE CASCADE,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_batch_orders_order_id ON dispatch_batch_orders(order_id);"]}, {"name": "order_assignments", "ddl": "CREATE TABLE order_assignments (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  driver_id INTEGER NOT NULL,\n  assigned_by_user_id INTEGER NOT NULL,\n  assigned_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  pickup_time_planned DATETIME,\n  dispatch_note TEXT,\n  unassigned_at DATETIME,\n  unassigned_reason TEXT,\n  is_current INTEGER NOT NULL DEFAULT 1 CHECK (is_current IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE,\n  FOREIGN KEY (driver_id) REFERENCES drivers(id) ON DELETE RESTRICT,\n  FOREIGN KEY (assigned_by_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE UNIQUE INDEX uq_order_current_assignment ON order_assignments(order_id) WHERE is_current = 1;", "CREATE INDEX idx_assignments_driver_current ON order_assignments(driver_id, is_current);", "CREATE INDEX idx_assignments_order_id ON order_assignments(order_id);"]}, {"name": "order_status_events", "ddl": "CREATE TABLE order_status_events (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  status TEXT NOT NULL CHECK (status IN (\n    'created','scheduled','dispatched','assigned','confirmed','picked_up','en_route','delivered','canceled','failed'\n  )),\n  event_time DATETIME NOT NULL,\n  eta DATETIME,\n  notes TEXT,\n  created_by_user_id INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE,\n  FOREIGN KEY (created_by_user_id) REFERENCES users(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_status_events_order_time ON order_status_events(order_id, event_time);", "CREATE INDEX idx_status_events_status ON order_status_events(status);"]}, {"name": "order_gps_pings", "ddl": "CREATE TABLE order_gps_pings (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  driver_id INTEGER,\n  ping_time DATETIME NOT NULL,\n  lat REAL NOT NULL,\n  lng REAL NOT NULL,\n  accuracy_m REAL,\n  source TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE,\n  FOREIGN KEY (driver_id) REFERENCES drivers(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_gps_order_time ON order_gps_pings(order_id, ping_time);"]}, {"name": "proof_of_delivery", "ddl": "CREATE TABLE proof_of_delivery (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL UNIQUE,\n  photo_url TEXT,\n  photo_timestamp DATETIME,\n  photo_notes TEXT,\n  recipient_signature_name TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_pod_order_id ON proof_of_delivery(order_id);"]}, {"name": "refunds", "ddl": "CREATE TABLE refunds (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  amount_cents INTEGER NOT NULL CHECK (amount_cents >= 0),\n  currency TEXT NOT NULL DEFAULT 'USD',\n  reason TEXT,\n  issued_by_user_id INTEGER NOT NULL,\n  issued_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE,\n  FOREIGN KEY (issued_by_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_refunds_order_id ON refunds(order_id);", "CREATE INDEX idx_refunds_issued_at ON refunds(issued_at);"]}, {"name": "internal_notes", "ddl": "CREATE TABLE internal_notes (\n  id INTEGER PRIMARY KEY,\n  entity_type TEXT NOT NULL CHECK (entity_type IN ('order','batch','support_case')),\n  entity_id INTEGER NOT NULL,\n  author_user_id INTEGER NOT NULL,\n  note TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (author_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_internal_notes_entity ON internal_notes(entity_type, entity_id);", "CREATE INDEX idx_internal_notes_created_at ON internal_notes(created_at);"]}, {"name": "support_cases", "ddl": "CREATE TABLE support_cases (\n  id INTEGER PRIMARY KEY,\n  order_id INTEGER NOT NULL,\n  channel TEXT NOT NULL CHECK (channel IN ('chat','email','phone')),\n  customer_message TEXT NOT NULL,\n  priority TEXT NOT NULL CHECK (priority IN ('low','medium','high','urgent')),\n  resolution_code TEXT CHECK (resolution_code IN (\n    'not_received','late_delivery','wrong_order','damaged','refund_request','other'\n  )),\n  status TEXT NOT NULL DEFAULT 'open' CHECK (status IN ('open','in_progress','resolved','closed')),\n  created_by_user_id INTEGER NOT NULL,\n  assigned_to_user_id INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (order_id) REFERENCES delivery_orders(id) ON DELETE CASCADE,\n  FOREIGN KEY (created_by_user_id) REFERENCES users(id) ON DELETE RESTRICT,\n  FOREIGN KEY (assigned_to_user_id) REFERENCES users(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_support_cases_order_id ON support_cases(order_id);", "CREATE INDEX idx_support_cases_priority_status ON support_cases(priority, status);", "CREATE INDEX idx_support_cases_created_at ON support_cases(created_at);"]}, {"name": "support_case_notes", "ddl": "CREATE TABLE support_case_notes (\n  id INTEGER PRIMARY KEY,\n  case_id INTEGER NOT NULL,\n  author_user_id INTEGER NOT NULL,\n  note TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (case_id) REFERENCES support_cases(id) ON DELETE CASCADE,\n  FOREIGN KEY (author_user_id) REFERENCES users(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_case_notes_case_id ON support_case_notes(case_id);", "CREATE INDEX idx_case_notes_created_at ON support_case_notes(created_at);"]}]}, "db_path": "./outputs/databases/doordash_drive_delivery_tracking.db"}
{"scenario": "Samsara (Fleet & Asset Maintenance Management)", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (\n  id INTEGER PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  email TEXT UNIQUE NOT NULL,\n  full_name TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_users_email ON users(email);"]}, {"name": "drivers", "ddl": "CREATE TABLE drivers (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  employee_id TEXT NOT NULL,\n  full_name TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, employee_id),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_drivers_user_id ON drivers(user_id);", "CREATE INDEX idx_drivers_employee_id ON drivers(employee_id);"]}, {"name": "vehicles", "ddl": "CREATE TABLE vehicles (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vin TEXT NOT NULL,\n  name TEXT NOT NULL,\n  license_plate TEXT,\n  odometer_miles INTEGER NOT NULL DEFAULT 0,\n  engine_hours REAL NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, vin),\n  UNIQUE(user_id, name),\n  UNIQUE(user_id, license_plate),\n  CHECK(length(vin) BETWEEN 11 AND 17),\n  CHECK(odometer_miles >= 0),\n  CHECK(engine_hours >= 0),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_vehicles_user_id ON vehicles(user_id);", "CREATE INDEX idx_vehicles_vin ON vehicles(vin);", "CREATE INDEX idx_vehicles_name ON vehicles(name);"]}, {"name": "vehicle_driver_assignments", "ddl": "CREATE TABLE vehicle_driver_assignments (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  driver_id INTEGER NOT NULL,\n  effective_start_at TEXT NOT NULL,\n  effective_end_at TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(effective_end_at IS NULL OR effective_end_at > effective_start_at),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE,\n  FOREIGN KEY (driver_id) REFERENCES drivers(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_vda_user_vehicle ON vehicle_driver_assignments(user_id, vehicle_id);", "CREATE INDEX idx_vda_user_driver ON vehicle_driver_assignments(user_id, driver_id);", "CREATE INDEX idx_vda_vehicle_time ON vehicle_driver_assignments(vehicle_id, effective_start_at, effective_end_at);"]}, {"name": "geofences", "ddl": "CREATE TABLE geofences (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  type TEXT NOT NULL,\n  center_lat REAL,\n  center_lng REAL,\n  radius_meters REAL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, name),\n  CHECK(type IN ('circle')),\n  CHECK(center_lat IS NULL OR (center_lat BETWEEN -90 AND 90)),\n  CHECK(center_lng IS NULL OR (center_lng BETWEEN -180 AND 180)),\n  CHECK(radius_meters IS NULL OR radius_meters > 0),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_geofences_user_id ON geofences(user_id);", "CREATE INDEX idx_geofences_name ON geofences(name);"]}, {"name": "geofence_alert_rules", "ddl": "CREATE TABLE geofence_alert_rules (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  geofence_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  alert_on_enter INTEGER NOT NULL DEFAULT 0,\n  alert_on_exit INTEGER NOT NULL DEFAULT 0,\n  enabled INTEGER NOT NULL DEFAULT 1,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, geofence_id, vehicle_id),\n  CHECK(alert_on_enter IN (0,1)),\n  CHECK(alert_on_exit IN (0,1)),\n  CHECK(enabled IN (0,1)),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (geofence_id) REFERENCES geofences(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_gfar_vehicle ON geofence_alert_rules(vehicle_id);", "CREATE INDEX idx_gfar_geofence ON geofence_alert_rules(geofence_id);"]}, {"name": "vehicle_safety_settings", "ddl": "CREATE TABLE vehicle_safety_settings (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  speeding_threshold_mph REAL,\n  speeding_min_duration_seconds INTEGER,\n  idling_threshold_minutes INTEGER,\n  severity TEXT NOT NULL,\n  enabled INTEGER NOT NULL DEFAULT 1,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, vehicle_id),\n  CHECK(severity IN ('low','medium','high')),\n  CHECK(enabled IN (0,1)),\n  CHECK(speeding_threshold_mph IS NULL OR speeding_threshold_mph >= 0),\n  CHECK(speeding_min_duration_seconds IS NULL OR speeding_min_duration_seconds >= 0),\n  CHECK(idling_threshold_minutes IS NULL OR idling_threshold_minutes >= 0),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_vss_vehicle ON vehicle_safety_settings(vehicle_id);"]}, {"name": "trips", "ddl": "CREATE TABLE trips (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  driver_id INTEGER,\n  start_at TEXT NOT NULL,\n  end_at TEXT NOT NULL,\n  start_lat REAL,\n  start_lng REAL,\n  end_lat REAL,\n  end_lng REAL,\n  avg_speed_mph REAL,\n  max_speed_mph REAL,\n  speeding_event_count INTEGER NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(end_at > start_at),\n  CHECK(start_lat IS NULL OR (start_lat BETWEEN -90 AND 90)),\n  CHECK(start_lng IS NULL OR (start_lng BETWEEN -180 AND 180)),\n  CHECK(end_lat IS NULL OR (end_lat BETWEEN -90 AND 90)),\n  CHECK(end_lng IS NULL OR (end_lng BETWEEN -180 AND 180)),\n  CHECK(avg_speed_mph IS NULL OR avg_speed_mph >= 0),\n  CHECK(max_speed_mph IS NULL OR max_speed_mph >= 0),\n  CHECK(speeding_event_count >= 0),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE,\n  FOREIGN KEY (driver_id) REFERENCES drivers(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_trips_vehicle_time ON trips(vehicle_id, start_at, end_at);", "CREATE INDEX idx_trips_driver_time ON trips(driver_id, start_at, end_at);"]}, {"name": "trip_gps_points", "ddl": "CREATE TABLE trip_gps_points (\n  id INTEGER PRIMARY KEY,\n  trip_id INTEGER NOT NULL,\n  seq INTEGER NOT NULL,\n  recorded_at TEXT,\n  lat REAL NOT NULL,\n  lng REAL NOT NULL,\n  speed_mph REAL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(trip_id, seq),\n  CHECK(lat BETWEEN -90 AND 90),\n  CHECK(lng BETWEEN -180 AND 180),\n  CHECK(seq >= 0),\n  CHECK(speed_mph IS NULL OR speed_mph >= 0),\n  FOREIGN KEY (trip_id) REFERENCES trips(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_tgp_trip ON trip_gps_points(trip_id);", "CREATE INDEX idx_tgp_trip_time ON trip_gps_points(trip_id, recorded_at);"]}, {"name": "sensor_readings", "ddl": "CREATE TABLE sensor_readings (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  recorded_at TEXT NOT NULL,\n  fuel_level_pct REAL,\n  engine_temp_f REAL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(fuel_level_pct IS NULL OR (fuel_level_pct BETWEEN 0 AND 100)),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_sensor_vehicle_time ON sensor_readings(vehicle_id, recorded_at);"]}, {"name": "vehicle_alerts", "ddl": "CREATE TABLE vehicle_alerts (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  trip_id INTEGER,\n  type TEXT NOT NULL,\n  severity TEXT NOT NULL,\n  start_at TEXT NOT NULL,\n  end_at TEXT,\n  message TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(type IN ('speeding','idling','engine_temp','geofence_enter','geofence_exit')),\n  CHECK(severity IN ('low','medium','high')),\n  CHECK(end_at IS NULL OR end_at > start_at),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE,\n  FOREIGN KEY (trip_id) REFERENCES trips(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_alerts_vehicle_time ON vehicle_alerts(vehicle_id, start_at);", "CREATE INDEX idx_alerts_type ON vehicle_alerts(type);"]}, {"name": "maintenance_schedules", "ddl": "CREATE TABLE maintenance_schedules (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  interval_miles INTEGER,\n  interval_engine_hours REAL,\n  next_due_odometer_miles INTEGER,\n  next_due_engine_hours REAL,\n  due_soon_miles INTEGER NOT NULL DEFAULT 0,\n  due_soon_engine_hours REAL NOT NULL DEFAULT 0,\n  enabled INTEGER NOT NULL DEFAULT 1,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(interval_miles IS NULL OR interval_miles > 0),\n  CHECK(interval_engine_hours IS NULL OR interval_engine_hours > 0),\n  CHECK(next_due_odometer_miles IS NULL OR next_due_odometer_miles >= 0),\n  CHECK(next_due_engine_hours IS NULL OR next_due_engine_hours >= 0),\n  CHECK(due_soon_miles >= 0),\n  CHECK(due_soon_engine_hours >= 0),\n  CHECK(enabled IN (0,1)),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_ms_vehicle ON maintenance_schedules(vehicle_id);", "CREATE INDEX idx_ms_vehicle_enabled ON maintenance_schedules(vehicle_id, enabled);"]}, {"name": "vendors", "ddl": "CREATE TABLE vendors (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, name),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_vendors_user_id ON vendors(user_id);", "CREATE INDEX idx_vendors_name ON vendors(name);"]}, {"name": "work_orders", "ddl": "CREATE TABLE work_orders (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  vendor_id INTEGER,\n  title TEXT NOT NULL,\n  priority TEXT NOT NULL,\n  reported_issue TEXT,\n  status TEXT NOT NULL,\n  open_date TEXT NOT NULL,\n  close_date TEXT,\n  odometer_at_repair_miles INTEGER,\n  estimated_labor_cost REAL,\n  estimated_parts_cost REAL,\n  actual_labor_cost REAL,\n  actual_parts_cost REAL,\n  notes TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(priority IN ('low','medium','high','urgent')),\n  CHECK(status IN ('open','closed')),\n  CHECK(close_date IS NULL OR close_date >= open_date),\n  CHECK(odometer_at_repair_miles IS NULL OR odometer_at_repair_miles >= 0),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE,\n  FOREIGN KEY (vendor_id) REFERENCES vendors(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_work_orders_vehicle ON work_orders(vehicle_id);", "CREATE INDEX idx_work_orders_status ON work_orders(status);", "CREATE INDEX idx_work_orders_vendor ON work_orders(vendor_id);", "CREATE INDEX idx_work_orders_open_date ON work_orders(open_date);"]}, {"name": "work_order_line_items", "ddl": "CREATE TABLE work_order_line_items (\n  id INTEGER PRIMARY KEY,\n  work_order_id INTEGER NOT NULL,\n  description TEXT NOT NULL,\n  part_number TEXT,\n  quantity REAL NOT NULL DEFAULT 1,\n  unit_cost REAL NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(quantity > 0),\n  CHECK(unit_cost >= 0),\n  FOREIGN KEY (work_order_id) REFERENCES work_orders(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_woli_work_order ON work_order_line_items(work_order_id);", "CREATE INDEX idx_woli_part_number ON work_order_line_items(part_number);"]}, {"name": "dvirs", "ddl": "CREATE TABLE dvirs (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  vehicle_id INTEGER NOT NULL,\n  driver_id INTEGER NOT NULL,\n  dvir_date TEXT NOT NULL,\n  submitted_at TEXT NOT NULL,\n  manager_ack_at TEXT,\n  manager_ack_notes TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, vehicle_id, driver_id, dvir_date),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE,\n  FOREIGN KEY (driver_id) REFERENCES drivers(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_dvirs_vehicle_date ON dvirs(vehicle_id, dvir_date);", "CREATE INDEX idx_dvirs_driver_date ON dvirs(driver_id, dvir_date);"]}, {"name": "dvir_defects", "ddl": "CREATE TABLE dvir_defects (\n  id INTEGER PRIMARY KEY,\n  dvir_id INTEGER NOT NULL,\n  description TEXT NOT NULL,\n  severity TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(severity IN ('minor','major')),\n  FOREIGN KEY (dvir_id) REFERENCES dvirs(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_dvir_defects_dvir ON dvir_defects(dvir_id);", "CREATE INDEX idx_dvir_defects_severity ON dvir_defects(severity);"]}, {"name": "dvir_defect_repairs", "ddl": "CREATE TABLE dvir_defect_repairs (\n  id INTEGER PRIMARY KEY,\n  dvir_defect_id INTEGER NOT NULL,\n  vendor_id INTEGER,\n  repaired_at TEXT,\n  verified_at TEXT,\n  cost REAL,\n  notes TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CHECK(cost IS NULL OR cost >= 0),\n  FOREIGN KEY (dvir_defect_id) REFERENCES dvir_defects(id) ON DELETE CASCADE,\n  FOREIGN KEY (vendor_id) REFERENCES vendors(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_ddr_defect ON dvir_defect_repairs(dvir_defect_id);", "CREATE INDEX idx_ddr_vendor ON dvir_defect_repairs(vendor_id);"]}]}, "db_path": "./outputs/databases/samsara_fleet_asset_maintenance_management.db"}
{"scenario": "Fortnite Item Shop", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (\n  id INTEGER PRIMARY KEY,\n  username TEXT NOT NULL UNIQUE,\n  email TEXT NOT NULL UNIQUE,\n  profile_json TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_users_email ON users(email);"]}, {"name": "friends", "ddl": "CREATE TABLE friends (\n  user_id INTEGER NOT NULL,\n  friend_user_id INTEGER NOT NULL,\n  status TEXT NOT NULL DEFAULT 'accepted' CHECK (status IN ('pending','accepted','blocked')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (user_id, friend_user_id),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (friend_user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CHECK (user_id <> friend_user_id)\n);", "indexes": ["CREATE INDEX idx_friends_user_status ON friends(user_id, status);", "CREATE INDEX idx_friends_friend_status ON friends(friend_user_id, status);"]}, {"name": "regions", "ddl": "CREATE TABLE regions (\n  id INTEGER PRIMARY KEY,\n  code TEXT NOT NULL UNIQUE,\n  name TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": []}, {"name": "items", "ddl": "CREATE TABLE items (\n  id INTEGER PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  category TEXT NOT NULL CHECK (category IN ('Outfit','Emote','Wrap','Bundle')),\n  rarity TEXT NOT NULL CHECK (rarity IN ('Common','Uncommon','Rare','Epic','Legendary','Mythic')),\n  description TEXT,\n  set_name TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_items_category_rarity ON items(category, rarity);", "CREATE INDEX idx_items_name ON items(name);"]}, {"name": "item_variants", "ddl": "CREATE TABLE item_variants (\n  id INTEGER PRIMARY KEY,\n  item_id INTEGER NOT NULL,\n  variant_name TEXT NOT NULL,\n  variant_type TEXT,\n  sort_order INTEGER NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,\n  UNIQUE (item_id, variant_name)\n);", "indexes": ["CREATE INDEX idx_item_variants_item ON item_variants(item_id, sort_order);"]}, {"name": "item_images", "ddl": "CREATE TABLE item_images (\n  id INTEGER PRIMARY KEY,\n  item_id INTEGER NOT NULL,\n  image_type TEXT NOT NULL CHECK (image_type IN ('icon','featured','background','bundle','other')),\n  url TEXT NOT NULL,\n  width INTEGER,\n  height INTEGER,\n  sort_order INTEGER NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_item_images_item ON item_images(item_id, image_type, sort_order);"]}, {"name": "bundles", "ddl": "CREATE TABLE bundles (\n  item_id INTEGER PRIMARY KEY,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE\n);", "indexes": []}, {"name": "bundle_items", "ddl": "CREATE TABLE bundle_items (\n  bundle_item_id INTEGER NOT NULL,\n  child_item_id INTEGER NOT NULL,\n  quantity INTEGER NOT NULL DEFAULT 1 CHECK (quantity > 0),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (bundle_item_id, child_item_id),\n  FOREIGN KEY (bundle_item_id) REFERENCES bundles(item_id) ON DELETE CASCADE,\n  FOREIGN KEY (child_item_id) REFERENCES items(id) ON DELETE RESTRICT,\n  CHECK (bundle_item_id <> child_item_id)\n);", "indexes": ["CREATE INDEX idx_bundle_items_bundle ON bundle_items(bundle_item_id);", "CREATE INDEX idx_bundle_items_child ON bundle_items(child_item_id);"]}, {"name": "shop_offers", "ddl": "CREATE TABLE shop_offers (\n  id INTEGER PRIMARY KEY,\n  region_id INTEGER NOT NULL,\n  offered_item_id INTEGER NOT NULL,\n  title_override TEXT,\n  price_vbucks INTEGER NOT NULL CHECK (price_vbucks >= 0),\n  starts_at DATETIME NOT NULL,\n  ends_at DATETIME NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (region_id) REFERENCES regions(id) ON DELETE RESTRICT,\n  FOREIGN KEY (offered_item_id) REFERENCES items(id) ON DELETE RESTRICT,\n  CHECK (ends_at > starts_at)\n);", "indexes": ["CREATE INDEX idx_shop_offers_region_window ON shop_offers(region_id, starts_at, ends_at);", "CREATE INDEX idx_shop_offers_region_active ON shop_offers(region_id, ends_at);", "CREATE INDEX idx_shop_offers_item ON shop_offers(offered_item_id);", "CREATE INDEX idx_shop_offers_price ON shop_offers(region_id, price_vbucks);"]}, {"name": "wishlists", "ddl": "CREATE TABLE wishlists (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL UNIQUE,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_wishlists_user ON wishlists(user_id);"]}, {"name": "wishlist_items", "ddl": "CREATE TABLE wishlist_items (\n  id INTEGER PRIMARY KEY,\n  wishlist_id INTEGER NOT NULL,\n  item_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (wishlist_id) REFERENCES wishlists(id) ON DELETE CASCADE,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,\n  UNIQUE (wishlist_id, item_id)\n);", "indexes": ["CREATE INDEX idx_wishlist_items_wishlist ON wishlist_items(wishlist_id, created_at);", "CREATE INDEX idx_wishlist_items_item ON wishlist_items(item_id);"]}, {"name": "price_alert_rules", "ddl": "CREATE TABLE price_alert_rules (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  item_id INTEGER NOT NULL,\n  region_id INTEGER NOT NULL,\n  max_price_vbucks INTEGER NOT NULL CHECK (max_price_vbucks >= 0),\n  is_active INTEGER NOT NULL DEFAULT 1 CHECK (is_active IN (0,1)),\n  last_triggered_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,\n  FOREIGN KEY (region_id) REFERENCES regions(id) ON DELETE RESTRICT,\n  UNIQUE (user_id, item_id, region_id, max_price_vbucks)\n);", "indexes": ["CREATE INDEX idx_price_alert_rules_user_active ON price_alert_rules(user_id, is_active);", "CREATE INDEX idx_price_alert_rules_item_region ON price_alert_rules(item_id, region_id, is_active);"]}, {"name": "wallets", "ddl": "CREATE TABLE wallets (\n  user_id INTEGER PRIMARY KEY,\n  balance_vbucks INTEGER NOT NULL DEFAULT 0 CHECK (balance_vbucks >= 0),\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": []}, {"name": "wallet_ledger", "ddl": "CREATE TABLE wallet_ledger (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  entry_type TEXT NOT NULL CHECK (entry_type IN ('purchase','gift','refund','adjustment')),\n  amount_vbucks INTEGER NOT NULL,\n  balance_after_vbucks INTEGER NOT NULL,\n  reference_type TEXT CHECK (reference_type IN ('purchase_receipt','gift_transaction','refund_transaction')),\n  reference_id INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_wallet_ledger_user_time ON wallet_ledger(user_id, created_at DESC);", "CREATE INDEX idx_wallet_ledger_reference ON wallet_ledger(reference_type, reference_id);"]}, {"name": "parental_controls", "ddl": "CREATE TABLE parental_controls (\n  user_id INTEGER PRIMARY KEY,\n  spend_limit_vbucks INTEGER NOT NULL DEFAULT 0 CHECK (spend_limit_vbucks >= 0),\n  spend_remaining_vbucks INTEGER NOT NULL DEFAULT 0 CHECK (spend_remaining_vbucks >= 0),\n  period TEXT NOT NULL DEFAULT 'unknown' CHECK (period IN ('daily','weekly','monthly','unknown')),\n  resets_at DATETIME,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": []}, {"name": "entitlements", "ddl": "CREATE TABLE entitlements (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  item_id INTEGER NOT NULL,\n  source_type TEXT NOT NULL CHECK (source_type IN ('purchase','gift')),\n  source_id INTEGER NOT NULL,\n  acquired_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  revoked_at DATETIME,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_entitlements_user_active ON entitlements(user_id, revoked_at);", "CREATE INDEX idx_entitlements_user_item ON entitlements(user_id, item_id);", "CREATE INDEX idx_entitlements_source ON entitlements(source_type, source_id);"]}, {"name": "purchase_receipts", "ddl": "CREATE TABLE purchase_receipts (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  offer_id INTEGER NOT NULL,\n  region_id INTEGER NOT NULL,\n  total_charged_vbucks INTEGER NOT NULL CHECK (total_charged_vbucks >= 0),\n  purchased_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  status TEXT NOT NULL DEFAULT 'completed' CHECK (status IN ('completed','failed','refunded')),\n  failure_code TEXT,\n  failure_message TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (offer_id) REFERENCES shop_offers(id) ON DELETE RESTRICT,\n  FOREIGN KEY (region_id) REFERENCES regions(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_purchase_receipts_user_time ON purchase_receipts(user_id, purchased_at DESC);", "CREATE INDEX idx_purchase_receipts_offer ON purchase_receipts(offer_id);", "CREATE INDEX idx_purchase_receipts_status ON purchase_receipts(user_id, status);"]}, {"name": "purchase_receipt_items", "ddl": "CREATE TABLE purchase_receipt_items (\n  id INTEGER PRIMARY KEY,\n  receipt_id INTEGER NOT NULL,\n  item_id INTEGER NOT NULL,\n  quantity INTEGER NOT NULL DEFAULT 1 CHECK (quantity > 0),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (receipt_id) REFERENCES purchase_receipts(id) ON DELETE CASCADE,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_purchase_receipt_items_receipt ON purchase_receipt_items(receipt_id);", "CREATE INDEX idx_purchase_receipt_items_item ON purchase_receipt_items(item_id);"]}, {"name": "gift_transactions", "ddl": "CREATE TABLE gift_transactions (\n  id INTEGER PRIMARY KEY,\n  sender_user_id INTEGER NOT NULL,\n  recipient_user_id INTEGER NOT NULL,\n  offer_id INTEGER NOT NULL,\n  region_id INTEGER NOT NULL,\n  message TEXT,\n  total_charged_vbucks INTEGER NOT NULL CHECK (total_charged_vbucks >= 0),\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending','delivered','failed','cancelled')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (sender_user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (recipient_user_id) REFERENCES users(id) ON DELETE RESTRICT,\n  FOREIGN KEY (offer_id) REFERENCES shop_offers(id) ON DELETE RESTRICT,\n  FOREIGN KEY (region_id) REFERENCES regions(id) ON DELETE RESTRICT,\n  CHECK (sender_user_id <> recipient_user_id)\n);", "indexes": ["CREATE INDEX idx_gift_transactions_sender_time ON gift_transactions(sender_user_id, created_at DESC);", "CREATE INDEX idx_gift_transactions_recipient_time ON gift_transactions(recipient_user_id, created_at DESC);", "CREATE INDEX idx_gift_transactions_status ON gift_transactions(status);"]}, {"name": "gift_transaction_items", "ddl": "CREATE TABLE gift_transaction_items (\n  id INTEGER PRIMARY KEY,\n  gift_transaction_id INTEGER NOT NULL,\n  item_id INTEGER NOT NULL,\n  quantity INTEGER NOT NULL DEFAULT 1 CHECK (quantity > 0),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (gift_transaction_id) REFERENCES gift_transactions(id) ON DELETE CASCADE,\n  FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_gift_items_gift ON gift_transaction_items(gift_transaction_id);"]}, {"name": "refund_tokens", "ddl": "CREATE TABLE refund_tokens (\n  user_id INTEGER PRIMARY KEY,\n  tokens_remaining INTEGER NOT NULL DEFAULT 0 CHECK (tokens_remaining >= 0),\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": []}, {"name": "refund_transactions", "ddl": "CREATE TABLE refund_transactions (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  purchase_receipt_id INTEGER NOT NULL,\n  token_used INTEGER NOT NULL DEFAULT 1 CHECK (token_used IN (0,1)),\n  vbucks_restored INTEGER NOT NULL CHECK (vbucks_restored >= 0),\n  status TEXT NOT NULL DEFAULT 'completed' CHECK (status IN ('completed','failed')),\n  failure_code TEXT,\n  failure_message TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (purchase_receipt_id) REFERENCES purchase_receipts(id) ON DELETE RESTRICT,\n  UNIQUE (purchase_receipt_id)\n);", "indexes": ["CREATE INDEX idx_refund_transactions_user_time ON refund_transactions(user_id, created_at DESC);"]}, {"name": "refund_transaction_entitlements", "ddl": "CREATE TABLE refund_transaction_entitlements (\n  refund_transaction_id INTEGER NOT NULL,\n  entitlement_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (refund_transaction_id, entitlement_id),\n  FOREIGN KEY (refund_transaction_id) REFERENCES refund_transactions(id) ON DELETE CASCADE,\n  FOREIGN KEY (entitlement_id) REFERENCES entitlements(id) ON DELETE RESTRICT\n);", "indexes": ["CREATE INDEX idx_refund_tx_entitlements_entitlement ON refund_transaction_entitlements(entitlement_id);"]}, {"name": "compliance_errors", "ddl": "CREATE TABLE compliance_errors (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  action_type TEXT NOT NULL CHECK (action_type IN ('purchase','gift')),\n  offer_id INTEGER,\n  attempted_total_vbucks INTEGER,\n  rule_code TEXT NOT NULL,\n  rule_description TEXT NOT NULL,\n  context_json TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (offer_id) REFERENCES shop_offers(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_compliance_errors_user_time ON compliance_errors(user_id, created_at DESC);", "CREATE INDEX idx_compliance_errors_rule ON compliance_errors(rule_code);"]}]}, "db_path": "./outputs/databases/fortnite_item_shop.db"}
{"scenario": "DocuSign (E-Signature & Agreement Workflow)", "db_schema": {"tables": [{"name": "users", "ddl": "CREATE TABLE users (\n  id INTEGER PRIMARY KEY,\n  username TEXT UNIQUE,\n  email TEXT UNIQUE NOT NULL,\n  full_name TEXT,\n  profile_json TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE UNIQUE INDEX idx_users_email ON users(email);", "CREATE UNIQUE INDEX idx_users_username ON users(username);"]}, {"name": "documents", "ddl": "CREATE TABLE documents (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  filename TEXT NOT NULL,\n  mime_type TEXT NOT NULL DEFAULT 'application/pdf',\n  storage_mode TEXT NOT NULL DEFAULT 'upload' CHECK (storage_mode IN ('upload','metadata_only')),\n  content_blob BLOB,\n  content_sha256 TEXT,\n  page_count INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_documents_owner ON documents(owner_user_id);", "CREATE INDEX idx_documents_sha ON documents(content_sha256);"]}, {"name": "envelopes", "ddl": "CREATE TABLE envelopes (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  title TEXT NOT NULL,\n  subject TEXT,\n  email_message TEXT,\n  status TEXT NOT NULL CHECK (status IN ('Created','Sent','Delivered','Completed','Declined','Voided')),\n  source_type TEXT NOT NULL CHECK (source_type IN ('template','upload','api_simulation')),\n  template_id INTEGER,\n  sent_at DATETIME,\n  completed_at DATETIME,\n  voided_at DATETIME,\n  void_reason TEXT,\n  expires_at DATETIME,\n  reminder_enabled INTEGER NOT NULL DEFAULT 0 CHECK (reminder_enabled IN (0,1)),\n  reminder_interval_days INTEGER,\n  reminder_next_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE SET NULL,\n  CHECK ((status != 'Voided') OR (void_reason IS NOT NULL)),\n  CHECK ((reminder_enabled = 0) OR (reminder_interval_days IS NOT NULL))\n);", "indexes": ["CREATE INDEX idx_envelopes_owner_status ON envelopes(owner_user_id, status);", "CREATE INDEX idx_envelopes_title ON envelopes(title);", "CREATE INDEX idx_envelopes_template ON envelopes(template_id);", "CREATE INDEX idx_envelopes_sent_at ON envelopes(sent_at);", "CREATE INDEX idx_envelopes_expires_at ON envelopes(expires_at);"]}, {"name": "envelope_documents", "ddl": "CREATE TABLE envelope_documents (\n  id INTEGER PRIMARY KEY,\n  envelope_id INTEGER NOT NULL,\n  document_id INTEGER NOT NULL,\n  doc_order INTEGER NOT NULL DEFAULT 1,\n  display_name TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (envelope_id) REFERENCES envelopes(id) ON DELETE CASCADE,\n  FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE RESTRICT,\n  UNIQUE (envelope_id, doc_order),\n  UNIQUE (envelope_id, document_id)\n);", "indexes": ["CREATE INDEX idx_envdocs_envelope ON envelope_documents(envelope_id);", "CREATE INDEX idx_envdocs_document ON envelope_documents(document_id);"]}, {"name": "envelope_recipients", "ddl": "CREATE TABLE envelope_recipients (\n  id INTEGER PRIMARY KEY,\n  envelope_id INTEGER NOT NULL,\n  role TEXT NOT NULL CHECK (role IN ('Signer','Approver','CC')),\n  routing_order INTEGER NOT NULL DEFAULT 1,\n  name TEXT NOT NULL,\n  email TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'Created' CHECK (status IN ('Created','Sent','Delivered','Signed','Approved','Completed','Declined','Voided')),\n  sms_phone TEXT,\n  auth_method TEXT CHECK (auth_method IN ('none','sms')),\n  auth_required INTEGER NOT NULL DEFAULT 0 CHECK (auth_required IN (0,1)),\n  delivered_at DATETIME,\n  acted_at DATETIME,\n  completed_at DATETIME,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (envelope_id) REFERENCES envelopes(id) ON DELETE CASCADE,\n  UNIQUE (envelope_id, email)\n);", "indexes": ["CREATE INDEX idx_recipients_envelope_order ON envelope_recipients(envelope_id, routing_order, id);", "CREATE INDEX idx_recipients_email ON envelope_recipients(email);", "CREATE INDEX idx_recipients_status ON envelope_recipients(status);"]}, {"name": "audit_events", "ddl": "CREATE TABLE audit_events (\n  id INTEGER PRIMARY KEY,\n  envelope_id INTEGER NOT NULL,\n  recipient_id INTEGER,\n  event_type TEXT NOT NULL CHECK (event_type IN ('created','sent','delivered','signed','approved','completed','declined','voided','expired','reminder_sent','viewed')),\n  event_at DATETIME NOT NULL,\n  ip_address TEXT,\n  user_agent TEXT,\n  details_json TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (envelope_id) REFERENCES envelopes(id) ON DELETE CASCADE,\n  FOREIGN KEY (recipient_id) REFERENCES envelope_recipients(id) ON DELETE SET NULL\n);", "indexes": ["CREATE INDEX idx_audit_envelope_type_time ON audit_events(envelope_id, event_type, event_at);", "CREATE INDEX idx_audit_recipient_time ON audit_events(recipient_id, event_at);", "CREATE INDEX idx_audit_event_at ON audit_events(event_at);"]}, {"name": "envelope_artifacts", "ddl": "CREATE TABLE envelope_artifacts (\n  id INTEGER PRIMARY KEY,\n  envelope_id INTEGER NOT NULL,\n  artifact_type TEXT NOT NULL CHECK (artifact_type IN ('certificate','final_audit_log','final_documents_zip','final_document_pdf')),\n  certificate_id TEXT,\n  content_blob BLOB,\n  content_sha256 TEXT,\n  content_mime_type TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (envelope_id) REFERENCES envelopes(id) ON DELETE CASCADE,\n  CHECK ((artifact_type != 'certificate') OR (certificate_id IS NOT NULL))\n);", "indexes": ["CREATE INDEX idx_artifacts_envelope_type ON envelope_artifacts(envelope_id, artifact_type);", "CREATE INDEX idx_artifacts_certificate_id ON envelope_artifacts(certificate_id);"]}, {"name": "tabs", "ddl": "CREATE TABLE tabs (\n  id INTEGER PRIMARY KEY,\n  envelope_id INTEGER NOT NULL,\n  document_id INTEGER,\n  recipient_id INTEGER NOT NULL,\n  tab_type TEXT NOT NULL CHECK (tab_type IN ('signature','date_signed','text','checkbox','checkbox_group')),\n  label TEXT,\n  required INTEGER NOT NULL DEFAULT 0 CHECK (required IN (0,1)),\n  anchor_text TEXT,\n  anchor_offset_x INTEGER,\n  anchor_offset_y INTEGER,\n  page_number INTEGER,\n  x_position REAL,\n  y_position REAL,\n  width REAL,\n  height REAL,\n  max_length INTEGER,\n  default_value TEXT,\n  value_text TEXT,\n  checked INTEGER CHECK (checked IN (0,1)),\n  group_id INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (envelope_id) REFERENCES envelopes(id) ON DELETE CASCADE,\n  FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE SET NULL,\n  FOREIGN KEY (recipient_id) REFERENCES envelope_recipients(id) ON DELETE CASCADE,\n  FOREIGN KEY (group_id) REFERENCES tab_groups(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_tabs_envelope_recipient ON tabs(envelope_id, recipient_id);", "CREATE INDEX idx_tabs_envelope_document ON tabs(envelope_id, document_id);", "CREATE INDEX idx_tabs_group ON tabs(group_id);"]}, {"name": "tab_groups", "ddl": "CREATE TABLE tab_groups (\n  id INTEGER PRIMARY KEY,\n  envelope_id INTEGER NOT NULL,\n  recipient_id INTEGER,\n  name TEXT NOT NULL,\n  group_type TEXT NOT NULL CHECK (group_type IN ('checkbox_group')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (envelope_id) REFERENCES envelopes(id) ON DELETE CASCADE,\n  FOREIGN KEY (recipient_id) REFERENCES envelope_recipients(id) ON DELETE SET NULL,\n  UNIQUE (envelope_id, name)\n);", "indexes": ["CREATE INDEX idx_tabgroups_envelope ON tab_groups(envelope_id);"]}, {"name": "templates", "ddl": "CREATE TABLE templates (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  is_active INTEGER NOT NULL DEFAULT 1 CHECK (is_active IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE (owner_user_id, name)\n);", "indexes": ["CREATE INDEX idx_templates_owner ON templates(owner_user_id);", "CREATE INDEX idx_templates_name ON templates(name);"]}, {"name": "template_roles", "ddl": "CREATE TABLE template_roles (\n  id INTEGER PRIMARY KEY,\n  template_id INTEGER NOT NULL,\n  role_name TEXT NOT NULL,\n  role_type TEXT NOT NULL CHECK (role_type IN ('Signer','Approver','CC')),\n  routing_order INTEGER NOT NULL DEFAULT 1,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,\n  UNIQUE (template_id, role_name)\n);", "indexes": ["CREATE INDEX idx_troles_template_order ON template_roles(template_id, routing_order, id);"]}, {"name": "template_documents", "ddl": "CREATE TABLE template_documents (\n  id INTEGER PRIMARY KEY,\n  template_id INTEGER NOT NULL,\n  document_id INTEGER NOT NULL,\n  doc_order INTEGER NOT NULL DEFAULT 1,\n  display_name TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,\n  FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE RESTRICT,\n  UNIQUE (template_id, doc_order),\n  UNIQUE (template_id, document_id)\n);", "indexes": ["CREATE INDEX idx_tdocs_template ON template_documents(template_id);"]}, {"name": "reusable_tabs", "ddl": "CREATE TABLE reusable_tabs (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  tab_type TEXT NOT NULL CHECK (tab_type IN ('text','checkbox')),\n  required INTEGER NOT NULL DEFAULT 0 CHECK (required IN (0,1)),\n  max_length INTEGER,\n  default_value TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE (owner_user_id, name)\n);", "indexes": ["CREATE INDEX idx_reusable_tabs_owner ON reusable_tabs(owner_user_id);", "CREATE INDEX idx_reusable_tabs_name ON reusable_tabs(name);"]}, {"name": "template_tabs", "ddl": "CREATE TABLE template_tabs (\n  id INTEGER PRIMARY KEY,\n  template_id INTEGER NOT NULL,\n  document_id INTEGER,\n  role_id INTEGER NOT NULL,\n  reusable_tab_id INTEGER,\n  tab_type TEXT NOT NULL CHECK (tab_type IN ('signature','date_signed','text','checkbox','checkbox_group')),\n  label TEXT,\n  required INTEGER NOT NULL DEFAULT 0 CHECK (required IN (0,1)),\n  anchor_text TEXT,\n  anchor_offset_x INTEGER,\n  anchor_offset_y INTEGER,\n  page_number INTEGER,\n  x_position REAL,\n  y_position REAL,\n  width REAL,\n  height REAL,\n  max_length INTEGER,\n  default_value TEXT,\n  checked INTEGER CHECK (checked IN (0,1)),\n  group_id INTEGER,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,\n  FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE SET NULL,\n  FOREIGN KEY (role_id) REFERENCES template_roles(id) ON DELETE CASCADE,\n  FOREIGN KEY (reusable_tab_id) REFERENCES reusable_tabs(id) ON DELETE SET NULL,\n  FOREIGN KEY (group_id) REFERENCES template_tab_groups(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_ttabs_template_role ON template_tabs(template_id, role_id);", "CREATE INDEX idx_ttabs_group ON template_tabs(group_id);", "CREATE INDEX idx_ttabs_reusable ON template_tabs(reusable_tab_id);"]}, {"name": "template_tab_groups", "ddl": "CREATE TABLE template_tab_groups (\n  id INTEGER PRIMARY KEY,\n  template_id INTEGER NOT NULL,\n  role_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  group_type TEXT NOT NULL CHECK (group_type IN ('checkbox_group')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,\n  FOREIGN KEY (role_id) REFERENCES template_roles(id) ON DELETE CASCADE,\n  UNIQUE (template_id, role_id, name)\n);", "indexes": ["CREATE INDEX idx_ttabgroups_template_role ON template_tab_groups(template_id, role_id);"]}, {"name": "permission_sets", "ddl": "CREATE TABLE permission_sets (\n  id INTEGER PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  description TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP\n);", "indexes": ["CREATE INDEX idx_permission_sets_name ON permission_sets(name);"]}, {"name": "user_groups", "ddl": "CREATE TABLE user_groups (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  name TEXT NOT NULL,\n  permission_set_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (permission_set_id) REFERENCES permission_sets(id) ON DELETE RESTRICT,\n  UNIQUE (owner_user_id, name)\n);", "indexes": ["CREATE INDEX idx_groups_owner ON user_groups(owner_user_id);", "CREATE INDEX idx_groups_permset ON user_groups(permission_set_id);"]}, {"name": "group_members", "ddl": "CREATE TABLE group_members (\n  group_id INTEGER NOT NULL,\n  user_id INTEGER NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (group_id, user_id),\n  FOREIGN KEY (group_id) REFERENCES user_groups(id) ON DELETE CASCADE,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_group_members_user ON group_members(user_id);"]}, {"name": "connect_subscriptions", "ddl": "CREATE TABLE connect_subscriptions (\n  id INTEGER PRIMARY KEY,\n  owner_user_id INTEGER NOT NULL,\n  name TEXT,\n  endpoint_url TEXT NOT NULL,\n  content_type TEXT NOT NULL DEFAULT 'application/json',\n  enabled INTEGER NOT NULL DEFAULT 1 CHECK (enabled IN (0,1)),\n  include_recipient_status INTEGER NOT NULL DEFAULT 0 CHECK (include_recipient_status IN (0,1)),\n  include_document_status INTEGER NOT NULL DEFAULT 0 CHECK (include_document_status IN (0,1)),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (owner_user_id) REFERENCES users(id) ON DELETE CASCADE\n);", "indexes": ["CREATE INDEX idx_connect_owner ON connect_subscriptions(owner_user_id);", "CREATE INDEX idx_connect_endpoint ON connect_subscriptions(endpoint_url);"]}, {"name": "connect_subscription_events", "ddl": "CREATE TABLE connect_subscription_events (\n  subscription_id INTEGER NOT NULL,\n  event_type TEXT NOT NULL CHECK (event_type IN ('sent','delivered','completed','declined','voided')),\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (subscription_id, event_type),\n  FOREIGN KEY (subscription_id) REFERENCES connect_subscriptions(id) ON DELETE CASCADE\n);", "indexes": []}]}, "db_path": "./outputs/databases/docusign_e_signature_agreement_workflow.db"}
